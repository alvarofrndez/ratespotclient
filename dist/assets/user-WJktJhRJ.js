import{z as d,i as R}from"./index-C1sxwVN5.js";const G=d("global",()=>({API_URL:"http://localhost:3000",USER_LOCALSTORAGE_KEY:"albondiga_frita",GROUP_LOCALSTORAGE_KEY:"salamance_alpinero",GROUP_LOCALSTORAGE_SALT:"647280043212"})),a=G(),T=d("group",()=>{const s=R({});async function n(e,t,o){const f=await fetch(a.API_URL+"/groups/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,code:t,username:o})});return f.ok?await f.json():!1}async function p(){const e=await fetch(a.API_URL+"/groups/generateCode");return e.ok?await e.json():!1}function i(e,t){e.value=e;const o=JSON.parse(localStorage.getItem(a.GROUP_LOCALSTORAGE_KEY))||[];o.push(a.GROUP_LOCALSTORAGE_SALT+""+e.id+"-"+e.code+"-"+t.id),localStorage.setItem(a.GROUP_LOCALSTORAGE_KEY,JSON.stringify(o))}async function _(){let e=localStorage.getItem(a.GROUP_LOCALSTORAGE_KEY),t=e?JSON.parse(e):[],o=[];for(let f of t){let L=f.split("-"),E=L[0].slice(a.GROUP_LOCALSTORAGE_SALT.length);const U=await O(E,L[2]);o.push(U)}return o}async function g(e){const t=await fetch(a.API_URL+"/groups/"+e);return t.ok?await t.json():!1}async function O(e,t){const o=await fetch(a.API_URL+"/groups/"+e+"/"+t);return o.ok?await o.json():!1}function A(e){e.value=e}function r(){const t=JSON.parse(localStorage.getItem(a.GROUP_LOCALSTORAGE_KEY)).filter(o=>o.split("-")[0]!==a.GROUP_LOCALSTORAGE_SALT+""+s.value.id);localStorage.setItem(a.GROUP_LOCALSTORAGE_KEY,JSON.stringify(t)),s.value={}}async function u(e){const t=await fetch(a.API_URL+"/groups/code/"+e);return t.ok?await t.json():!1}async function c(e){const t=await fetch(a.API_URL+"/groups/delete/"+e,{method:"DELETE"});return t.ok?await t.json():!1}return{group:s,createGroup:n,generateCode:p,setNewGroup:i,getGroupsOfLocalStorage:_,getGroupById:g,getGroupByIdWithUser:O,setActiveGroup:A,leaveGroup:r,getGroupByCode:u,deleteGroup:c}}),l=G(),S=T(),P=d("user",()=>{const s=R({}),n=R(null);async function p(){let r=localStorage.getItem(l.USER_LOCALSTORAGE_KEY);return r&&await i(r)?(n.value=!0,!0):(n.value=!1,!1)}async function i(r){const u=await fetch(`${l.API_URL}/users/${r}`);if(!u.ok)return!1;const c=await u.json();return s.value=c.user,S.group=c.group,!0}function _(r){s.value=r,n.value=!0,localStorage.setItem(l.USER_LOCALSTORAGE_KEY,r.id)}async function g(){return(await fetch(`${l.API_URL}/groups/leave`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:s.value.id})})).ok?(s.value={},n.value=!1,localStorage.removeItem(l.USER_LOCALSTORAGE_KEY),S.leaveGroup(),!0):!1}async function O(r,u){const c=await fetch(`${l.API_URL}/users/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,group_id:u.id})});if(!c.ok)return!1;const e=await c.json();return _(e.user),S.setNewGroup(u,e.user),!0}function A(){s.value={},n.value=!1,localStorage.removeItem(l.USER_LOCALSTORAGE_KEY)}return{user:s,user_active:n,check:p,getUserWithGroup:i,setActiveUser:_,leaveGroup:g,joinToGroup:O,logout:A}});export{G as a,T as g,P as u};
